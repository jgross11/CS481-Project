<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    <script src="helperFunctions.js"></script>
    <input type=text" id="username"><br>
    <input type="password" id="password"><br>
    <input type="button" value="Receive Data" onclick="submitAndReceiveData()">
    <div id="error"></div>
    </form>
</body>

<script>

    // backend communication functions must be async
    function submitAndReceiveData(){

        // get username, password from form
        var formUsername = document.getElementById("username").value;
        var formPassword = document.getElementById("password").value;

        // construct 'user' object for easy json stringification
        var user = {
            username: formUsername,
            password: formPassword
        };
        var data;

        /*
            this function warrants an explanation
            postData POSTS the user object via JSON to the address 'receiveData-submit'
            this takes some time (obviously), and so when the server responds
            the .then function is called, which executes an async function
            that is given the server response. The data is then de-JSON'd
            (the reason that the async keyword is necessary)
            into a usable format, and then the logic handling
            a good / bad response is executed.
        */

        /*
        option one - all the code in one place
        fetch(address, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(objectToPost)
        }).then(function(response){
            response.json().then(function(data){
                console.log("data: ");
                console.log(data);

                // successful login - store login info in session
                if(data){

                    // store user information in session info
                    // TODO determine way to store user object, rather than parts
                    sessionStorage.setItem("username", user.username);
                    sessionStorage.setItem("password", user.password);

                    // for example, go to homepage
                    window.location.href = "/";
                }
                else{
                    document.getElementById("error").innerHTML = "invalid login";
                }
            });
        });

        */
        // option two - post is hidden, response function is present

        postData('receiveData-submit', user).then(async function(response){
            data = await response.json();
            console.log("data: ");
            console.log(data);

            // successful login - store login info in session
            if(data){

                // store user information in session info
                // TODO determine way to store user object, rather than parts
                sessionStorage.setItem("username", user.username);
                sessionStorage.setItem("password", user.password);

                // for example, go to homepage
                window.location.href = "/";
            }
            else{
                document.getElementById("error").innerHTML = "invalid login";
            }
        });

        /*
        option three - post and response function are hidden
        postData('receiveData-submit', user).then(responseFunction(response));

        //...

        async function responseFunction(response){
            data = await response.json();
            console.log("data: ");
            console.log(data);

            // successful login - store login info in session
            if(data){

                // store user information in session info
                // TODO determine way to store user object, rather than parts
                sessionStorage.setItem("username", user.username);
                sessionStorage.setItem("password", user.password);

                // for example, go to homepage
                window.location.href = "/";
            }
            else{
                document.getElementById("error").innerHTML = "invalid login";
            }
        }
        */
    }
</script>
</html>